{"version":3,"file":"volunteer-phone-buddy-Clz65IcU.js","sources":["../src/components/forms/volunteer-phone-buddy.js"],"sourcesContent":["import {\n  serializeInputs,\n  setupOtherFieldForSelect,\n  setupOtherFieldForCheckbox,\n  clearStepsErrors,\n  appendStepsErrors,\n  setButtonLoading,\n  resetButton,\n  hideFail,\n  showFail,\n  showSuccess,\n  hideForm,\n} from '../../utils/functions'\n\nimport validator from 'validator'\n\n/**\n * Handles form submission for a multi-step form component.\n * @param {HTMLElement} component - The form component containing steps and inputs.\n */\nexport default function (component) {\n  const formInstances = component.forEach ? component : [component]\n\n  formInstances.forEach((formInstance) => {\n    const webhookAddress = formInstance.dataset.webhook || 'https://hook.us2.make.com/vpc32gcapub110y6fye9o46a8nnlw7fq'\n    const steps = Array.from(formInstance.querySelectorAll('[data-form=\"step\"]'))\n    const ticketIdField = formInstance.querySelector('[data-volunteer-phone-buddy-form=\"ticket-id-field\"]')\n\n    const nextButton = formInstance.querySelector('[data-form=\"next-btn\"]')\n    const nextButtonInitialText = nextButton.firstChild.textContent\n\n    const submitButton = formInstance.querySelector('[data-form=\"submit-btn\"]')\n    const submitButtonInitialText = submitButton.firstChild.textContent\n\n    const successEl = formInstance.querySelector('.w-form-done')\n    const failEl = formInstance.querySelector('.w-form-fail')\n    const formEl = formInstance.querySelector('form')\n\n    if (ticketIdField) {\n      ticketIdField.disabled = true\n      ticketIdField.type = 'hidden'\n    }\n\n    setupOtherFieldForSelect({\n      context: formInstance,\n      selectId: 'Volunteer-Cancer-type',\n      otherValue: 557,\n      fieldName: 'Other-cancer-type',\n      labelName: 'Specify other type of lung cancer',\n      placeholder: 'Specify here',\n      wrapperClass: 'multi-form14_field-wrapper',\n    })\n\n    setupOtherFieldForSelect({\n      context: formInstance,\n      selectId: 'Volunteer-How-did-you-heard-about-us',\n      otherValue: 98,\n      fieldName: 'Volunteer-Other-way-of-hearing-about-GO2',\n      labelName: 'Describe other way of hearing about GO2',\n      placeholder: 'Specify here',\n      wrapperClass: 'multi-form14_field-wrapper',\n    })\n\n    setupOtherFieldForCheckbox({\n      context: formInstance,\n      checkboxGroup: 'Volunteer-Phone-Buddy-Treatment',\n      otherValue: 8,\n      fieldName: 'Volunteer-Other-treatment',\n      labelName: 'Specify treatment',\n      placeholder: 'Specify here',\n      wrapperClass: 'multi-form14_field-wrapper',\n    })\n\n    // hide all steps except the first one\n    steps.forEach((step, i) => {\n      if (i !== 0) step.classList.add('hide')\n    })\n\n    formInstance.addEventListener('click', (e) => {\n      const target = e.target\n      const nextBtn = target.closest('[data-form=\"next-btn\"]')\n      const submitBtn = target.closest('[data-form=\"submit-btn\"]')\n      const buttonText = target.closest('.button_text')\n\n      // NEXT BUTTON HANDLER\n      if (nextBtn || (buttonText && nextBtn)) {\n        // Hide fail element on button press (validations will rerun)\n        hideFail(failEl)\n\n        const currentStepEl = nextBtn.closest('[data-form=\"step\"]')\n        if (!currentStepEl) return // Avoid errors if no step found\n\n        const currentStepIndex = Array.from(formEl?.children || []).indexOf(currentStepEl)\n        if (currentStepIndex === -1) return // Invalid index, abort\n\n        // Log for debugging\n        console.log('Next button pressed - Step index:', currentStepIndex)\n\n        const stepInputsData = serializeInputs(currentStepEl)\n\n        // Log serialized data for debugging\n        console.log('Next button - Serialized step data:', stepInputsData)\n\n        const errors = []\n\n        // Step-specific validations\n        switch (currentStepIndex) {\n          case 0:\n            // First step validations\n            if (validator.isEmpty(stepInputsData['Volunteer-Phone-Buddy-Name'] || '')) {\n              errors.push({\n                fieldName: 'Volunteer-Phone-Buddy-Name',\n                error: 'Enter your full name',\n                appendAt: '.multi-form14_field-wrapper',\n              })\n            }\n            if (!validator.isEmail(stepInputsData['Volunteer-Phone-Buddy-Email'] || '')) {\n              errors.push({\n                fieldName: 'Volunteer-Phone-Buddy-Email',\n                error: 'Enter a valid email address (example: name@email.com)',\n                appendAt: '.multi-form14_field-wrapper',\n              })\n            }\n            const phone = stepInputsData['Volunteer-Phone-Buddy-Phone'] || ''\n            if (!validator.isMobilePhone(phone, 'any')) {\n              errors.push({\n                fieldName: 'Volunteer-Phone-Buddy-Phone',\n                error: 'Enter a valid phone number (include area code)',\n                appendAt: '.multi-form14_field-wrapper',\n              })\n            }\n            break\n\n          // Add more cases as needed for other steps\n\n          default:\n            break\n        }\n\n        // Clear any existing errors\n        clearStepsErrors(currentStepEl)\n\n        // If there are errors, append them and stop\n        if (errors.length > 0) {\n          appendStepsErrors(errors, currentStepEl)\n          return\n        }\n\n        // Set loading state\n        const nextBtnTextEl = nextBtn.querySelector('.button_text') || nextBtn.firstChild\n        const nextBtnInitialText = nextBtnTextEl?.textContent || 'Next'\n        setButtonLoading(nextBtn)\n\n        fetch(webhookAddress, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(stepInputsData),\n        })\n          .then((response) => {\n            if (!response.ok) {\n              throw new Error(`HTTP error! status: ${response.status}`)\n            }\n            return response.json()\n          })\n          .then((data) => {\n            if (ticketIdField) {\n              ticketIdField.value = data?.ticket || data || ''\n            }\n\n            // Hide current step and show next if exists\n            currentStepEl.classList.add('hide')\n            const nextIndex = currentStepIndex + 1\n            if (nextIndex < steps.length) {\n              steps[nextIndex].classList.remove('hide')\n            } else {\n              console.log('no more steps')\n            }\n          })\n          .catch((error) => {\n            console.error('Fetch error:', error)\n            showFail(failEl)\n          })\n          .finally(() => {\n            resetButton(nextBtn, nextBtnInitialText)\n          })\n      }\n\n      // SUBMIT BUTTON HANDLER\n      if (submitBtn || (buttonText && submitBtn)) {\n        e.preventDefault()\n        e.stopImmediatePropagation()\n\n        // Hide fail element on button press (validations will rerun)\n        hideFail(failEl)\n\n        const currentStepEl = submitBtn.closest('[data-form=\"step\"]')\n        if (!currentStepEl) return // Avoid errors if no step found\n\n        const currentStepIndex = Array.from(formEl?.children || []).indexOf(currentStepEl)\n        if (currentStepIndex === -1) return // Invalid index, abort\n\n        // Log for debugging\n        console.log('Submit button pressed - Step index:', currentStepIndex)\n\n        const submitInputsData = serializeInputs(currentStepEl)\n\n        // Log serialized data for debugging\n        console.log('Submit button - Serialized submit data:', submitInputsData)\n\n        const errors = []\n\n        // Submit step validations\n        if (!validator.isPostalCode(String(submitInputsData?.['Volunteer-Phone-Buddy-Zip-Code'] || ''), 'any')) {\n          errors.push({\n            fieldName: 'Volunteer-Phone-Buddy-Zip-Code',\n            error: 'Enter a valid ZIP or postal code',\n            appendAt: '.multi-form14_field-wrapper',\n          })\n        }\n\n        if ('Other-cancer-type' in submitInputsData && validator.isEmpty(submitInputsData['Other-cancer-type'] || '')) {\n          errors.push({\n            fieldName: 'Other-cancer-type',\n            error: 'Tell us what type of cancer you have',\n            appendAt: '.multi-form14_field-wrapper',\n          })\n        }\n\n        if (\n          'Volunteer-Other-treatment' in submitInputsData &&\n          validator.isEmpty(submitInputsData['Volunteer-Other-treatment'] || '')\n        ) {\n          errors.push({\n            fieldName: 'Volunteer-Other-treatment',\n            error: 'Specify the treatment you received',\n            appendAt: '.multi-form14_field-wrapper',\n          })\n        }\n\n        if (\n          'Volunteer-Other-way-of-hearing-about-GO2' in submitInputsData &&\n          validator.isEmpty(submitInputsData['Volunteer-Other-way-of-hearing-about-GO2'] || '')\n        ) {\n          errors.push({\n            fieldName: 'Volunteer-Other-way-of-hearing-about-GO2',\n            error: 'Describe how you heard about GO2',\n            appendAt: '.multi-form14_field-wrapper',\n          })\n        }\n\n        // Clear any existing errors\n        clearStepsErrors(currentStepEl)\n\n        // If there are errors, append them and stop\n        if (errors.length > 0) {\n          appendStepsErrors(errors, currentStepEl)\n          return\n        }\n\n        // Set loading state\n        const submitBtnTextEl = submitBtn.querySelector('.button_text') || submitBtn.firstChild\n        const submitBtnInitialText = submitBtnTextEl?.textContent || 'Submit'\n        setButtonLoading(submitBtn)\n\n        submitInputsData['ticket-id'] = ticketIdField.value\n\n        // Modify message to contain information about: Phone-Buddy-Treatment, Other-treatment, How-did-you-heard-about-us, and Other-way-of-hearing-about-GO2\n        let message = submitInputsData['Interest-in-becoming-a-Phone-Buddy'] || ''\n        const fieldsToAppend = [\n          { key: 'Volunteer-Phone-Buddy-Treatment', label: 'Treatment' },\n          { key: 'Volunteer-Other-treatment', label: 'Other treatment' },\n          {\n            key: 'Volunteer-How-did-you-heard-about-us',\n            label: 'How did you hear about GO2?',\n          },\n          {\n            key: 'Volunteer-Other-way-of-hearing-about-GO2',\n            label: 'Other way of hearing about GO2',\n          },\n        ]\n        // REMAKE THIS SENDING HTML INSTEAD OF TEXT: Format appended fields as HTML for better rendering in the webhook receiver\n        let appended = ''\n        fieldsToAppend.forEach((field) => {\n          if (submitInputsData.hasOwnProperty(field.key)) {\n            const value = submitInputsData[field.key]\n            let formattedValue = ''\n            if (Array.isArray(value) && value.length > 0) {\n              formattedValue = value.join(', ')\n            } else if (typeof value === 'string' && value.trim() !== '') {\n              formattedValue = value\n            } else if (value != null && value.toString().trim() !== '') {\n              formattedValue = value.toString()\n            }\n            if (formattedValue) {\n              appended += `<br><strong>${field.label}:</strong> ${formattedValue}`\n            }\n          }\n        })\n        // Update the message if there's anything to append\n        if (appended) {\n          message = message.trim() ? `${message.trim()}.<br>${appended.trim()}` : appended.trim()\n        }\n        submitInputsData['Interest-in-becoming-a-Phone-Buddy'] = message\n\n        // Log final submit data for debugging\n        console.log('Final submit data (with modified message):', submitInputsData)\n\n        fetch(webhookAddress, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(submitInputsData),\n        })\n          .then((response) => {\n            if (!response.ok) throw new Error('Submission failed')\n            return response.json()\n          })\n          .then((data) => {\n            hideForm(formEl)\n            showSuccess(successEl)\n          })\n          .catch((error) => {\n            console.error('Submit fetch error:', error)\n            showFail(failEl)\n          })\n          .finally(() => {\n            resetButton(submitBtn, submitBtnInitialText)\n          })\n      }\n    })\n  })\n}\n"],"names":["volunteerPhoneBuddy","component","forEach","formInstance","webhookAddress","dataset","webhook","steps","Array","from","querySelectorAll","ticketIdField","querySelector","firstChild","textContent","successEl","failEl","formEl","disabled","type","setupOtherFieldForSelect","context","selectId","otherValue","fieldName","labelName","placeholder","setupOtherFieldForCheckbox","checkboxGroup","wrapperClass","step","i","classList","add","addEventListener","e","target","nextBtn","closest","submitBtn","buttonText","hideFail","currentStepEl","currentStepIndex","children","indexOf","stepInputsData","serializeInputs","errors","validator","isEmpty","push","error","appendAt","isEmail","phone","isMobilePhone","clearStepsErrors","length","appendStepsErrors","nextBtnTextEl","nextBtnInitialText","setButtonLoading","fetch","method","headers","body","JSON","stringify","then","response","ok","Error","status","json","data","value","ticket","nextIndex","remove","catch","showFail","finally","resetButton","preventDefault","stopImmediatePropagation","submitInputsData","isPostalCode","String","submitBtnTextEl","submitBtnInitialText","message","appended","key","label","field","hasOwnProperty","formattedValue","isArray","join","trim","toString","hideForm","showSuccess"],"mappings":"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"}