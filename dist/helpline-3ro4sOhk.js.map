{"version":3,"file":"helpline-3ro4sOhk.js","sources":["../src/components/forms/helpline.js"],"sourcesContent":["import { serializeInputs } from '../../utils/functions'\n\n/**\n * Handles form submission for a multi-step form component.\n * @param {HTMLElement} component - The form component containing steps and inputs.\n */\nexport default function (component) {\n  const webhookAddress = component.dataset.webhook || 'https://hook.us2.make.com/x3fm8t3nor5poc4ij7purslvicjo9sxr'\n  const steps = component.querySelectorAll('[data-form=\"step\"]')\n  const ticketIdField = component.querySelector('[data-helpline-form=\"ticket-id-field\"]')\n  const nextButton = component.querySelector('[data-form=\"next-btn\"]')\n  const nextButtonInitialText = nextButton.firstChild.textContent\n\n  const submitButton = component.querySelector('[data-form=\"submit-btn\"]')\n  const submitButtonInitialText = submitButton.firstChild.textContent\n\n  const successEl = component.querySelector('.w-form-done')\n  const failEl = component.querySelector('.w-form-fail')\n  const formEl = component.querySelector('form')\n\n  if (ticketIdField) {\n    ticketIdField.disabled = true\n    ticketIdField.type = 'hidden'\n  }\n\n  nextButton.addEventListener(\n    'click',\n    (e) => {\n      // Skip processing for synthetic (dispatched) events â€“ let Formly handle them\n      if (!e.isTrusted) return\n\n      if (e.currentTarget.classList.contains('disabled')) {\n        e.preventDefault()\n        e.stopImmediatePropagation()\n        return\n      }\n\n      // Prevent Formly from advancing immediately\n      e.preventDefault()\n      e.stopImmediatePropagation()\n\n      const firstStepData = serializeInputs(steps[0])\n\n      // Disable button during async fetch\n      nextButton.disabled = true\n      nextButton.classList.add('disabled')\n      nextButton.firstChild.textContent = 'Please wait...'\n\n      fetch(webhookAddress, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(firstStepData),\n      })\n        .then((response) => {\n          if (!response.ok) throw new Error('Submission failed')\n          return response.json()\n        })\n        .then((data) => {\n          if (ticketIdField) {\n            ticketIdField.value = data || ''\n          }\n          // Dispatch synthetic click to trigger Formly's step advancement\n          const syntheticClick = new MouseEvent('click', {\n            bubbles: true,\n            cancelable: true,\n            view: window,\n          })\n          nextButton.dispatchEvent(syntheticClick)\n          failEl.style.display = 'none'\n          failEl.setAttribute('aria-hidden', 'true')\n        })\n        .catch((error) => {\n          if (failEl) {\n            failEl.style.display = 'block'\n            failEl.setAttribute('aria-hidden', 'false')\n            failEl.setAttribute('tabindex', '-1')\n            setTimeout(() => failEl.focus(), 50)\n          }\n        })\n        .finally(() => {\n          nextButton.disabled = false\n          nextButton.classList.remove('disabled')\n          nextButton.firstChild.textContent = nextButtonInitialText\n        })\n    },\n    true // Capture phase to intercept before Formly\n  )\n\n  submitButton.addEventListener(\n    'click',\n    (e) => {\n      e.preventDefault()\n      e.stopImmediatePropagation()\n\n      if (ticketIdField?.value) {\n        const secondStepData = serializeInputs(steps[1])\n        secondStepData['ticket-id'] = ticketIdField.value\n\n        submitButton.disabled = true\n        submitButton.classList.add('disabled')\n        submitButton.firstChild.textContent = 'Please wait...'\n\n        fetch(webhookAddress, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(secondStepData),\n        })\n          .then((response) => {\n            if (!response.ok) throw new Error('Submission failed')\n            return response.json()\n          })\n          .then((data) => {\n            if (formEl) {\n              formEl.style.display = 'none'\n              formEl.setAttribute('aria-hidden', 'true')\n            }\n            if (failEl) {\n              failEl.style.display = 'none'\n              failEl.setAttribute('aria-hidden', 'true')\n            }\n\n            if (successEl) {\n              successEl.style.display = 'block'\n              successEl.setAttribute('aria-hidden', 'false')\n              successEl.setAttribute('tabindex', '-1')\n              setTimeout(() => successEl.focus(), 50)\n            }\n          })\n          .catch((error) => {\n            if (formEl) {\n              formEl.setAttribute('aria-hidden', 'true')\n            }\n            if (successEl) {\n              successEl.style.display = 'none'\n              successEl.setAttribute('aria-hidden', 'true')\n            }\n\n            if (failEl) {\n              failEl.style.display = 'block'\n              failEl.setAttribute('aria-hidden', 'false')\n              failEl.setAttribute('tabindex', '-1')\n              setTimeout(() => failEl.focus(), 50)\n            }\n          })\n          .finally(() => {\n            submitButton.disabled = false\n            submitButton.classList.remove('disabled')\n            submitButton.firstChild.textContent = submitButtonInitialText\n          })\n      } else {\n        alert('There was an error updating your information...')\n      }\n    },\n    true\n  )\n}\n"],"names":["helpline","component","webhookAddress","dataset","webhook","steps","querySelectorAll","ticketIdField","querySelector","nextButton","nextButtonInitialText","firstChild","textContent","submitButton","submitButtonInitialText","successEl","failEl","formEl","disabled","type","addEventListener","e","isTrusted","currentTarget","classList","contains","preventDefault","stopImmediatePropagation","firstStepData","serializeInputs","add","fetch","method","headers","body","JSON","stringify","then","response","ok","Error","json","data","value","syntheticClick","MouseEvent","bubbles","cancelable","view","window","dispatchEvent","style","display","setAttribute","catch","error","setTimeout","focus","finally","remove","secondStepData","alert"],"mappings":"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"}