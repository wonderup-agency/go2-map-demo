{"version":3,"file":"phone-buddy-BC0sFQlo.js","sources":["../src/components/forms/phone-buddy.js"],"sourcesContent":["import {\n  serializeInputs,\n  setupOtherFieldForSelect,\n  setupOtherFieldForCheckbox,\n} from '../../utils/functions'\n\n/**\n * Handles form submission for a multi-step form component.\n * @param {HTMLElement} component - The form component containing steps and inputs.\n */\nexport default function (component) {\n  const webhookAddress =\n    component.dataset.webhook ||\n    'https://hook.us2.make.com/kkvr63k2dtf7sgpx5n2alylvmgf2qvd5'\n  const steps = component.querySelectorAll('[data-form=\"step\"]')\n  const ticketIdField = component.querySelector(\n    '[data-phone-buddy-form=\"ticket-id-field\"]'\n  )\n\n  const nextButton = component.querySelector('[data-form=\"next-btn\"]')\n  const nextButtonInitialText = nextButton.firstChild.textContent\n\n  const submitButton = component.querySelector('[data-form=\"submit-btn\"]')\n  const submitButtonInitialText = submitButton.firstChild.textContent\n\n  const successEl = component.querySelector('.w-form-done')\n  const failEl = component.querySelector('.w-form-fail')\n  const formEl = component.querySelector('form')\n\n  if (ticketIdField) {\n    ticketIdField.disabled = true\n    ticketIdField.type = 'hidden'\n  }\n\n  setupOtherFieldForSelect({\n    selectId: 'Cancer-type',\n    otherValue: 557,\n    fieldName: 'Other-cancer-type',\n    labelName: 'Specify other type of lung cancer',\n    placeholder: 'Specify here',\n  })\n\n  setupOtherFieldForSelect({\n    selectId: 'How-did-you-heard-about-us',\n    otherValue: 98,\n    fieldName: 'Other-way-of-hearing-about-GO2',\n    labelName: 'Describe other way of hearing about GO2',\n    placeholder: 'Specify here',\n  })\n\n  setupOtherFieldForCheckbox({\n    checkboxGroup: 'Phone-Buddy-Treatment',\n    otherValue: 8,\n    fieldName: 'Other-treatment',\n    labelName: 'Specify treatment',\n    placeholder: 'Specify here',\n  })\n\n  nextButton.addEventListener(\n    'click',\n    (e) => {\n      // Skip processing for synthetic (dispatched) events â€“ let Formly handle them\n      if (!e.isTrusted) return\n\n      if (e.currentTarget.classList.contains('disabled')) {\n        e.preventDefault()\n        e.stopImmediatePropagation()\n        return\n      }\n\n      // Prevent Formly from advancing immediately\n      e.preventDefault()\n      e.stopImmediatePropagation()\n\n      const firstStepData = serializeInputs(steps[0])\n\n      // Disable button during async fetch\n      nextButton.disabled = true\n      nextButton.classList.add('disabled')\n      nextButton.firstChild.textContent = 'Please wait...'\n\n      fetch(webhookAddress, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(firstStepData),\n      })\n        .then((response) => {\n          if (!response.ok) throw new Error('Submission failed')\n          return response.json()\n        })\n        .then((data) => {\n          if (ticketIdField) {\n            ticketIdField.value = data || ''\n          }\n          // Dispatch synthetic click to trigger Formly's step advancement\n          const syntheticClick = new MouseEvent('click', {\n            bubbles: true,\n            cancelable: true,\n            view: window,\n          })\n          nextButton.dispatchEvent(syntheticClick)\n          failEl.style.display = 'none'\n          failEl.setAttribute('aria-hidden', 'true')\n        })\n        .catch((error) => {\n          if (failEl) {\n            failEl.style.display = 'block'\n            failEl.setAttribute('aria-hidden', 'false')\n            failEl.setAttribute('tabindex', '-1')\n            setTimeout(() => failEl.focus(), 50)\n          }\n        })\n        .finally(() => {\n          nextButton.disabled = false\n          nextButton.classList.remove('disabled')\n          nextButton.firstChild.textContent = nextButtonInitialText\n        })\n    },\n    true // Capture phase to intercept before Formly\n  )\n\n  submitButton.addEventListener(\n    'click',\n    (e) => {\n      e.preventDefault()\n      e.stopImmediatePropagation()\n\n      if (ticketIdField?.value) {\n        const secondStepData = serializeInputs(steps[1])\n        // const secondStepData = serializeInputs(formEl)\n        secondStepData['ticket-id'] = ticketIdField.value\n\n        // Modify message to contain information about: Phone-Buddy-Treatment, Other-treatment, How-did-you-heard-about-us, and Other-way-of-hearing-about-GO2\n        let message = secondStepData['Phone-Buddy-Message'] || ''\n        const fieldsToAppend = [\n          { key: 'Phone-Buddy-Treatment', label: 'Treatment' },\n          { key: 'Other-treatment', label: 'Other treatment' },\n          {\n            key: 'How-did-you-heard-about-us',\n            label: 'How did you hear about GO2?',\n          },\n          {\n            key: 'Other-way-of-hearing-about-GO2',\n            label: 'Other way of hearing about GO2',\n          },\n        ]\n\n        //REMAKE THIS SENDING HTML INSTEAD OF TEXT: https://grok.com/c/b93e7ca3-9ed5-4017-a34b-914c12900b49\n        // Build the appended string\n        let appended = ''\n        fieldsToAppend.forEach((field) => {\n          if (secondStepData.hasOwnProperty(field.key)) {\n            const value = secondStepData[field.key]\n            if (Array.isArray(value) && value.length > 0) {\n              appended += `\\n${field.label}: ${value.join(', ')}`\n            } else if (typeof value === 'string' && value.trim() !== '') {\n              appended += `\\n${field.label}: ${value}`\n            }\n            // For other types (e.g., numbers), coerce to string and add if non-empty\n            else if (value != null && value.toString().trim() !== '') {\n              appended += `\\n${field.label}: ${value}`\n            }\n          }\n        })\n        // Update the message if there's anything to append\n        if (appended) {\n          message = message.trim()\n            ? `${message.trim()}.\\n${appended.trim()}`\n            : appended.trim()\n        }\n        secondStepData['Phone-Buddy-Message'] = message\n\n        submitButton.disabled = true\n        submitButton.classList.add('disabled')\n        submitButton.firstChild.textContent = 'Please wait...'\n\n        fetch(webhookAddress, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(secondStepData),\n        })\n          .then((response) => {\n            if (!response.ok) throw new Error('Submission failed')\n            return response.json()\n          })\n          .then((data) => {\n            if (formEl) {\n              formEl.style.display = 'none'\n              formEl.setAttribute('aria-hidden', 'true')\n            }\n            if (failEl) {\n              failEl.style.display = 'none'\n              failEl.setAttribute('aria-hidden', 'true')\n            }\n\n            if (successEl) {\n              successEl.style.display = 'block'\n              successEl.setAttribute('aria-hidden', 'false')\n              successEl.setAttribute('tabindex', '-1')\n              setTimeout(() => successEl.focus(), 50)\n            }\n          })\n          .catch((error) => {\n            if (formEl) {\n              formEl.setAttribute('aria-hidden', 'true')\n            }\n            if (successEl) {\n              successEl.style.display = 'none'\n              successEl.setAttribute('aria-hidden', 'true')\n            }\n\n            if (failEl) {\n              failEl.style.display = 'block'\n              failEl.setAttribute('aria-hidden', 'false')\n              failEl.setAttribute('tabindex', '-1')\n              setTimeout(() => failEl.focus(), 50)\n            }\n          })\n          .finally(() => {\n            submitButton.disabled = false\n            submitButton.classList.remove('disabled')\n            submitButton.firstChild.textContent = submitButtonInitialText\n          })\n      } else {\n        alert('There was an error updating your information...')\n      }\n    },\n    true\n  )\n}\n"],"names":["phoneBuddy","component","webhookAddress","dataset","webhook","steps","querySelectorAll","ticketIdField","querySelector","nextButton","nextButtonInitialText","firstChild","textContent","submitButton","submitButtonInitialText","successEl","failEl","formEl","disabled","type","setupOtherFieldForSelect","selectId","otherValue","fieldName","labelName","placeholder","setupOtherFieldForCheckbox","checkboxGroup","addEventListener","e","isTrusted","currentTarget","classList","contains","preventDefault","stopImmediatePropagation","firstStepData","serializeInputs","add","fetch","method","headers","body","JSON","stringify","then","response","ok","Error","json","data","value","syntheticClick","MouseEvent","bubbles","cancelable","view","window","dispatchEvent","style","display","setAttribute","catch","error","setTimeout","focus","finally","remove","secondStepData","message","appended","key","label","forEach","field","hasOwnProperty","Array","isArray","length","join","trim","toString","alert"],"mappings":"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"}