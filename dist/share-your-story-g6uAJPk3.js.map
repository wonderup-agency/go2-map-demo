{"version":3,"file":"share-your-story-g6uAJPk3.js","sources":["../src/components/forms/share-your-story.js"],"sourcesContent":["import {\r\n  serializeInputs,\r\n  clearStepsErrors,\r\n  appendStepsErrors,\r\n  setButtonLoading,\r\n  resetButton,\r\n  hideFail,\r\n  showFail,\r\n  showSuccess,\r\n  hideForm,\r\n  setupOtherFieldForCheckbox,\r\n  setupOtherFieldForSelect,\r\n  dependentFieldsForSelect,\r\n} from '../../utils/functions'\r\n\r\nimport validator from 'validator'\r\n\r\n/**\r\n * Handles form submission for a multi-step form component.\r\n * @param {HTMLElement} component - The form component containing steps and inputs.\r\n */\r\nexport default function (component) {\r\n  const formInstances = component.forEach ? component : [component]\r\n\r\n  formInstances.forEach((formInstance) => {\r\n    const webhookAddress = formInstance.dataset.webhook || 'https://hook.us2.make.com/8obr35mtbmpo6xdqasiq9ythue5h2s2g'\r\n\r\n    const successEl = formInstance.querySelector('.w-form-done')\r\n    const failEl = formInstance.querySelector('.w-form-fail')\r\n    const formEl = formInstance.querySelector('form')\r\n\r\n    setupOtherFieldForSelect({\r\n      context: formInstance,\r\n      selectId: 'connection-to-lung-cancer',\r\n      otherValue: 'other-connection',\r\n      fieldName: 'other-connection-to-cancer',\r\n      labelName: 'Specify other connection',\r\n      placeholder: 'Specify your connection to lung cancer',\r\n      wrapperClass: 'multi-form14_field-wrapper',\r\n    })\r\n    setupOtherFieldForSelect({\r\n      context: formInstance,\r\n      selectId: 'cancer-type',\r\n      otherValue: 'other-type',\r\n      fieldName: 'other-cancer-type',\r\n      labelName: 'Other cancer type',\r\n      placeholder: 'Specify type of cancer',\r\n      wrapperClass: 'multi-form14_field-wrapper',\r\n    })\r\n    dependentFieldsForSelect({\r\n      context: formInstance,\r\n      selectId: 'diagnosed',\r\n      dependentValue: 'is-diagnosed',\r\n    })\r\n\r\n    const fileInput = document.getElementById('photo-files')\r\n    const listDiv = document.getElementById('files-list')\r\n    let selectedFiles = []\r\n    fileInput.addEventListener('click', () => {\r\n      listDiv.innerHTML = ''\r\n      selectedFiles = []\r\n    })\r\n    fileInput.addEventListener('change', () => {\r\n      const files = Array.from(fileInput.files)\r\n      if (files.length === 0) return\r\n      listDiv.innerHTML = ''\r\n      selectedFiles = []\r\n      let completedFiles = 0\r\n\r\n      files.forEach((file) => {\r\n        const reader = new FileReader()\r\n        reader.addEventListener('load', () => {\r\n          completedFiles++\r\n          selectedFiles.push(file)\r\n          if (completedFiles === files.length) {\r\n            displayFileList()\r\n          }\r\n        })\r\n        reader.addEventListener('error', () => {\r\n          alert(`Error loading ${file.name}`)\r\n        })\r\n        reader.readAsDataURL(file) // Read to simulate loading to memory with progress\r\n      })\r\n    })\r\n    function displayFileList() {\r\n      listDiv.innerHTML = ''\r\n      selectedFiles.forEach((file, index) => {\r\n        const fileItem = document.createElement('div')\r\n        const removeBtn = document.createElement('button')\r\n        removeBtn.textContent = '(remove)'\r\n        removeBtn.type = 'button'\r\n        removeBtn.addEventListener('click', () => {\r\n          selectedFiles.splice(index, 1)\r\n          updateInputFiles()\r\n          displayFileList()\r\n        })\r\n        fileItem.textContent = `${file.name} `\r\n        fileItem.appendChild(removeBtn)\r\n        listDiv.appendChild(fileItem)\r\n      })\r\n    }\r\n    function updateInputFiles() {\r\n      const dt = new DataTransfer()\r\n      selectedFiles.forEach((file) => dt.items.add(file))\r\n      fileInput.files = dt.files\r\n    }\r\n\r\n    formInstance.addEventListener('click', async (e) => {\r\n      const target = e.target\r\n      const submitBtn = target.closest('[data-form=\"submit-btn\"]')\r\n      const buttonText = target.closest('.button_text')\r\n\r\n      // SUBMIT BUTTON HANDLER\r\n      if (submitBtn || (buttonText && submitBtn)) {\r\n        e.preventDefault()\r\n        e.stopImmediatePropagation()\r\n\r\n        // Hide fail element on button press (validations will rerun)\r\n        hideFail(failEl)\r\n\r\n        const submitInputsData = await serializeInputs(formEl)\r\n\r\n        // Log serialized data for debugging\r\n        console.log('Submit button - Serialized submit data:', submitInputsData)\r\n\r\n        const errors = []\r\n\r\n        // Submit step validations\r\n        if (validator.isEmpty(submitInputsData['full-name'] || '')) {\r\n          errors.push({\r\n            fieldName: 'full-name',\r\n            error: 'Enter your full name.',\r\n            appendAt: '.multi-form14_field-wrapper',\r\n          })\r\n        }\r\n        if (!validator.isEmail(submitInputsData['email'] || '')) {\r\n          errors.push({\r\n            fieldName: 'email',\r\n            error: 'Enter a valid email address (example: name@email.com)',\r\n            appendAt: '.multi-form14_field-wrapper',\r\n          })\r\n        }\r\n        if (validator.isEmpty(submitInputsData['city'] || '')) {\r\n          errors.push({\r\n            fieldName: 'city',\r\n            error: 'Enter a valid city name',\r\n            appendAt: '.multi-form14_field-wrapper',\r\n          })\r\n        }\r\n\r\n        if (\r\n          'other-connection-to-cancer' in submitInputsData &&\r\n          validator.isEmpty(submitInputsData['other-connection-to-cancer'] || '')\r\n        ) {\r\n          errors.push({\r\n            fieldName: 'other-connection-to-cancer',\r\n            error: 'Tell us your connection to lung cancer',\r\n            appendAt: '.multi-form14_field-wrapper',\r\n          })\r\n        }\r\n\r\n        if (validator.isEmpty(submitInputsData['experience'] || '')) {\r\n          errors.push({\r\n            fieldName: 'experience',\r\n            error: 'Please tell us your experience with lung cancer.',\r\n            appendAt: '.multi-form14_field-wrapper',\r\n          })\r\n        }\r\n\r\n        const diagnosisDateInput = formInstance.querySelector(`#diagnosis-date`)\r\n        const diagnosisDateWrapper = diagnosisDateInput.closest('[data-depends-on]')\r\n        const validateDiagnosisDate = diagnosisDateWrapper.getAttribute('data-active') === 'true'\r\n        const diagnosisDate = submitInputsData['diagnosis-date'] ?? ''\r\n        if (validateDiagnosisDate && validator.isEmpty(diagnosisDate)) {\r\n          errors.push({\r\n            fieldName: 'diagnosis-date',\r\n            error: 'Enter the diangosis date',\r\n            appendAt: '.multi-form14_field-wrapper',\r\n          })\r\n        }\r\n\r\n        // Clear any existing errors\r\n        clearStepsErrors(formEl)\r\n\r\n        // If there are errors, append them and stop\r\n        if (errors.length > 0) {\r\n          appendStepsErrors(errors)\r\n          return\r\n        }\r\n\r\n        // remove conditional fields from final object\r\n        if (document.querySelector('#diagnosed').value != 'is-diagnosed') {\r\n          delete submitInputsData['cancer-type']\r\n          delete submitInputsData['cancer-stage']\r\n          delete submitInputsData['diagnosis-date']\r\n          delete submitInputsData['other-cancer-type']\r\n        }\r\n        delete submitInputsData['photo-files-old']\r\n\r\n        // Set loading state\r\n        const submitBtnTextEl = submitBtn.querySelector('.button_text') || submitBtn.firstChild\r\n        const submitBtnInitialText = submitBtnTextEl?.textContent || 'Submit'\r\n        setButtonLoading(submitBtn)\r\n\r\n        fetch(webhookAddress, {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify(submitInputsData),\r\n        })\r\n          .then((response) => {\r\n            if (!response.ok) throw new Error('Submission failed')\r\n            return response.json()\r\n          })\r\n          .then((data) => {\r\n            hideForm(formEl)\r\n            showSuccess(successEl)\r\n          })\r\n          .catch((error) => {\r\n            console.error('Submit fetch error:', error)\r\n            showFail(failEl)\r\n          })\r\n          .finally(() => {\r\n            resetButton(submitBtn, submitBtnInitialText)\r\n          })\r\n      }\r\n    })\r\n  })\r\n}\r\n"],"names":[],"mappings":"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"}