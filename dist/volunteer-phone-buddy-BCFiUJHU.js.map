{"version":3,"file":"volunteer-phone-buddy-BCFiUJHU.js","sources":["../src/components/forms/volunteer-phone-buddy.js"],"sourcesContent":["import {\n  serializeInputs,\n  setupOtherFieldForSelect,\n  setupOtherFieldForCheckbox,\n  clearStepsErrors,\n  appendStepsErrors,\n  setButtonLoading,\n  resetButton,\n  hideFail,\n  showFail,\n  showSuccess,\n  hideForm,\n} from '../../utils/functions'\n\nimport validator from 'validator'\n\n/**\n * Handles form submission for a multi-step form component.\n * @param {HTMLElement} component - The form component containing steps and inputs.\n */\nexport default function (component) {\n  const formInstances = component.forEach ? component : [component]\n\n  formInstances.forEach((formInstance) => {\n    const webhookAddress = formInstance.dataset.webhook || 'https://hook.us2.make.com/vpc32gcapub110y6fye9o46a8nnlw7fq'\n    const steps = Array.from(formInstance.querySelectorAll('[data-form=\"step\"]'))\n    const ticketIdField = formInstance.querySelector('[data-volunteer-phone-buddy-form=\"ticket-id-field\"]')\n\n    const nextButton = formInstance.querySelector('[data-form=\"next-btn\"]')\n    const nextButtonInitialText = nextButton.firstChild.textContent\n\n    const submitButton = formInstance.querySelector('[data-form=\"submit-btn\"]')\n    const submitButtonInitialText = submitButton.firstChild.textContent\n\n    const successEl = formInstance.querySelector('.w-form-done')\n    const failEl = formInstance.querySelector('.w-form-fail')\n    const formEl = formInstance.querySelector('form')\n\n    if (ticketIdField) {\n      ticketIdField.disabled = true\n      ticketIdField.type = 'hidden'\n    }\n\n    setupOtherFieldForSelect({\n      context: formInstance,\n      selectId: 'Volunteer-Cancer-type',\n      otherValue: 557,\n      fieldName: 'Other-cancer-type',\n      labelName: 'Specify other type of lung cancer',\n      placeholder: 'Specify here',\n    })\n\n    setupOtherFieldForSelect({\n      context: formInstance,\n      selectId: 'Volunteer-How-did-you-heard-about-us',\n      otherValue: 98,\n      fieldName: 'Volunteer-Other-way-of-hearing-about-GO2',\n      labelName: 'Describe other way of hearing about GO2',\n      placeholder: 'Specify here',\n    })\n\n    setupOtherFieldForCheckbox({\n      context: formInstance,\n      checkboxGroup: 'Volunteer-Phone-Buddy-Treatment',\n      otherValue: 8,\n      fieldName: 'Volunteer-Other-treatment',\n      labelName: 'Specify treatment',\n      placeholder: 'Specify here',\n    })\n\n    // hide all steps except the first one\n    steps.forEach((step, i) => {\n      if (i !== 0) step.classList.add('hide')\n    })\n\n    formInstance.addEventListener('click', (e) => {\n      const target = e.target\n      const nextBtn = target.closest('[data-form=\"next-btn\"]')\n      const submitBtn = target.closest('[data-form=\"submit-btn\"]')\n      const buttonText = target.closest('.button_text')\n\n      // NEXT BUTTON HANDLER\n      if (nextBtn || (buttonText && nextBtn)) {\n        // Hide fail element on button press (validations will rerun)\n        hideFail(failEl)\n\n        const currentStepEl = nextBtn.closest('[data-form=\"step\"]')\n        if (!currentStepEl) return // Avoid errors if no step found\n\n        const currentStepIndex = Array.from(formEl?.children || []).indexOf(currentStepEl)\n        if (currentStepIndex === -1) return // Invalid index, abort\n\n        // Log for debugging\n        console.log('Next button pressed - Step index:', currentStepIndex)\n\n        const stepInputsData = serializeInputs(currentStepEl)\n\n        // Log serialized data for debugging\n        console.log('Next button - Serialized step data:', stepInputsData)\n\n        const errors = []\n\n        // Step-specific validations\n        switch (currentStepIndex) {\n          case 0:\n            // First step validations\n            if (validator.isEmpty(stepInputsData['Volunteer-Phone-Buddy-Name'] || '')) {\n              errors.push('Enter your full name.')\n            }\n            if (!validator.isEmail(stepInputsData['Volunteer-Phone-Buddy-Email'] || '')) {\n              errors.push('Enter a valid email address (example: name@email.com)')\n            }\n            if (!validator.isMobilePhone(stepInputsData['Volunteer-Phone-Buddy-Phone'] || '')) {\n              errors.push('Enter a valid phone number (digits only, include area code)')\n            }\n            break\n\n          // Add more cases as needed for other steps\n\n          default:\n            break\n        }\n\n        // Clear any existing errors\n        clearStepsErrors(currentStepEl)\n\n        // If there are errors, append them and stop\n        if (errors.length > 0) {\n          appendStepsErrors(currentStepEl, errors)\n          return\n        }\n\n        // Set loading state\n        const nextBtnTextEl = nextBtn.querySelector('.button_text') || nextBtn.firstChild\n        const nextBtnInitialText = nextBtnTextEl?.textContent || 'Next'\n        setButtonLoading(nextBtn)\n\n        fetch(webhookAddress, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(stepInputsData),\n        })\n          .then((response) => {\n            if (!response.ok) {\n              throw new Error(`HTTP error! status: ${response.status}`)\n            }\n            return response.json()\n          })\n          .then((data) => {\n            if (ticketIdField) {\n              ticketIdField.value = data?.ticket || data || ''\n            }\n\n            // Hide current step and show next if exists\n            currentStepEl.classList.add('hide')\n            const nextIndex = currentStepIndex + 1\n            if (nextIndex < steps.length) {\n              steps[nextIndex].classList.remove('hide')\n            } else {\n              console.log('no more steps')\n            }\n          })\n          .catch((error) => {\n            console.error('Fetch error:', error)\n            showFail(failEl)\n          })\n          .finally(() => {\n            resetButton(nextBtn, nextBtnInitialText)\n          })\n      }\n\n      // SUBMIT BUTTON HANDLER\n      if (submitBtn || (buttonText && submitBtn)) {\n        e.preventDefault()\n        e.stopImmediatePropagation()\n\n        // Hide fail element on button press (validations will rerun)\n        hideFail(failEl)\n\n        const currentStepEl = submitBtn.closest('[data-form=\"step\"]')\n        if (!currentStepEl) return // Avoid errors if no step found\n\n        const currentStepIndex = Array.from(formEl?.children || []).indexOf(currentStepEl)\n        if (currentStepIndex === -1) return // Invalid index, abort\n\n        // Log for debugging\n        console.log('Submit button pressed - Step index:', currentStepIndex)\n\n        const submitInputsData = serializeInputs(currentStepEl)\n\n        // Log serialized data for debugging\n        console.log('Submit button - Serialized submit data:', submitInputsData)\n\n        const errors = []\n\n        // Submit step validations\n        if (!validator.isPostalCode(String(submitInputsData?.['Volunteer-Phone-Buddy-Zip-Code'] || ''), 'any')) {\n          errors.push('Enter a valid ZIP or postal code.')\n        }\n\n        if ('Other-cancer-type' in submitInputsData && validator.isEmpty(submitInputsData['Other-cancer-type'] || '')) {\n          errors.push('Tell us what type of cancer you have.')\n        }\n\n        if (\n          'Volunteer-Other-treatment' in submitInputsData &&\n          validator.isEmpty(submitInputsData['Volunteer-Other-treatment'] || '')\n        ) {\n          errors.push('Specify the treatment you received.')\n        }\n\n        if (\n          'Volunteer-Other-way-of-hearing-about-GO2' in submitInputsData &&\n          validator.isEmpty(submitInputsData['Volunteer-Other-way-of-hearing-about-GO2'] || '')\n        ) {\n          errors.push('Describe how you heard about GO2.')\n        }\n\n        // Clear any existing errors\n        clearStepsErrors(currentStepEl)\n\n        // If there are errors, append them and stop\n        if (errors.length > 0) {\n          appendStepsErrors(currentStepEl, errors)\n          return\n        }\n\n        // Set loading state\n        const submitBtnTextEl = submitBtn.querySelector('.button_text') || submitBtn.firstChild\n        const submitBtnInitialText = submitBtnTextEl?.textContent || 'Submit'\n        setButtonLoading(submitBtn)\n\n        submitInputsData['ticket-id'] = ticketIdField.value\n\n        // Modify message to contain information about: Phone-Buddy-Treatment, Other-treatment, How-did-you-heard-about-us, and Other-way-of-hearing-about-GO2\n        let message = submitInputsData['Interest-in-becoming-a-Phone-Buddy'] || ''\n        const fieldsToAppend = [\n          { key: 'Volunteer-Phone-Buddy-Treatment', label: 'Treatment' },\n          { key: 'Volunteer-Other-treatment', label: 'Other treatment' },\n          {\n            key: 'Volunteer-How-did-you-heard-about-us',\n            label: 'How did you hear about GO2?',\n          },\n          {\n            key: 'Volunteer-Other-way-of-hearing-about-GO2',\n            label: 'Other way of hearing about GO2',\n          },\n        ]\n        // REMAKE THIS SENDING HTML INSTEAD OF TEXT: Format appended fields as HTML for better rendering in the webhook receiver\n        let appended = ''\n        fieldsToAppend.forEach((field) => {\n          if (submitInputsData.hasOwnProperty(field.key)) {\n            const value = submitInputsData[field.key]\n            let formattedValue = ''\n            if (Array.isArray(value) && value.length > 0) {\n              formattedValue = value.join(', ')\n            } else if (typeof value === 'string' && value.trim() !== '') {\n              formattedValue = value\n            } else if (value != null && value.toString().trim() !== '') {\n              formattedValue = value.toString()\n            }\n            if (formattedValue) {\n              appended += `<br><strong>${field.label}:</strong> ${formattedValue}`\n            }\n          }\n        })\n        // Update the message if there's anything to append\n        if (appended) {\n          message = message.trim() ? `${message.trim()}.<br>${appended.trim()}` : appended.trim()\n        }\n        submitInputsData['Interest-in-becoming-a-Phone-Buddy'] = message\n\n        // Log final submit data for debugging\n        console.log('Final submit data (with modified message):', submitInputsData)\n\n        fetch(webhookAddress, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(submitInputsData),\n        })\n          .then((response) => {\n            if (!response.ok) throw new Error('Submission failed')\n            return response.json()\n          })\n          .then((data) => {\n            hideForm(formEl)\n            showSuccess(successEl)\n          })\n          .catch((error) => {\n            console.error('Submit fetch error:', error)\n            showFail(failEl)\n          })\n          .finally(() => {\n            resetButton(submitBtn, submitBtnInitialText)\n          })\n      }\n    })\n  })\n}\n"],"names":["volunteerPhoneBuddy","component","forEach","formInstance","webhookAddress","dataset","webhook","steps","Array","from","querySelectorAll","ticketIdField","querySelector","firstChild","textContent","successEl","failEl","formEl","disabled","type","setupOtherFieldForSelect","context","selectId","otherValue","fieldName","labelName","placeholder","setupOtherFieldForCheckbox","checkboxGroup","step","i","classList","add","addEventListener","e","target","nextBtn","closest","submitBtn","buttonText","hideFail","currentStepEl","currentStepIndex","children","indexOf","stepInputsData","serializeInputs","errors","validator","isEmpty","push","isEmail","isMobilePhone","clearStepsErrors","length","appendStepsErrors","nextBtnTextEl","nextBtnInitialText","setButtonLoading","fetch","method","headers","body","JSON","stringify","then","response","ok","Error","status","json","data","value","ticket","nextIndex","remove","catch","error","showFail","finally","resetButton","preventDefault","stopImmediatePropagation","submitInputsData","isPostalCode","String","submitBtnTextEl","submitBtnInitialText","message","appended","key","label","field","hasOwnProperty","formattedValue","isArray","join","trim","toString","hideForm","showSuccess"],"mappings":"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"}