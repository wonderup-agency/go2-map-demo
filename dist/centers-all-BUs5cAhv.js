import{s as e,i as t,M as n,S as r}from"./index.esm-Cl_mq6FY.js";var a={imageUrl:"https://cdn.prod.website-files.com/685abc7fe66bf3b67a6af38e/699cc04ab55333725658f5c0_pin-coe.png",size:[52,52],anchor:[26,52]},i={imageUrl:"https://cdn.prod.website-files.com/685abc7fe66bf3b67a6af38e/699cbe556ade1b088be0322b_pin-nci.png",size:[32,32],anchor:[16,32]},o={imageUrl:"https://cdn.prod.website-files.com/685abc7fe66bf3b67a6af38e/699cbe5541e827aa53093410_pin-coc.png",size:[32,32],anchor:[16,32]},s={screening:"Screening",cancer_care:"Cancer Care",ipn:"IPN",biomarker:"Biomarker"};function l(e){if(s[e])return s[e];var t=e.replace(/_/g," ");return t.charAt(0).toUpperCase()+t.slice(1)}function c(e){return{url:e.imageUrl,scaledSize:new google.maps.Size(e.size[0],e.size[1]),anchor:new google.maps.Point(e.anchor[0],e.anchor[1])}}function d(e){var t='<div style="max-width:240px;font-family:Arial,sans-serif;">';return t+='<strong style="font-size:14px;">'+e.name+"</strong>",t+='<div style="font-size:13px;color:#444;margin:6px 0;">'+e.address+"</div>",e.imageUrl&&(t+='<img src="'+e.imageUrl+'" alt="'+e.name+'" style="width:100%;border-radius:4px;margin-bottom:6px;" />'),e.phone&&(t+='<div><a href="tel:'+e.phone+'" style="font-size:13px;">'+e.phone+"</a></div>"),t+='<div style="margin-top:4px;"><a href="'+("https://www.google.com/maps/dir/?api=1&destination="+e.lat+","+e.lng+"&travelmode=driving")+'" target="_blank" rel="noopener" style="font-size:13px;">Get Directions</a></div>',t+="</div>"}async function p(s){var p=s.querySelector("[data-centers='list']"),g=s.querySelector("[data-centers='map']"),f=s.querySelector("[data-custom='centers-zip-field']"),m=s.querySelector(".map_filters-right-category-nav"),u=document.querySelector('[data-centers="list-item"]').cloneNode(!0),h="true"===s.getAttribute("data-show-only-screening");p.innerHTML='<p style="padding:1rem;color:#666;">Loading centers...</p>';try{e({key:"AIzaSyDzjnzJImLe2q2uc8ziZYmQVPrI9TDukww",v:"weekly"}),await t("maps"),await t("marker")}catch(e){return void(g.innerHTML='<p style="padding:1rem;color:red;">Failed to load Google Maps. Please try again later.</p>')}var v=new google.maps.Map(g,{center:{lat:37.5,lng:-95.7},zoom:4}),w=c(a);c(i),c(o);var y=w,b=new google.maps.InfoWindow,x=[],k=[];try{var z=fetch("https://go2-worker.nahuel-eba.workers.dev/centers"),S=fetch("https://go2-worker.nahuel-eba.workers.dev/centers/designations"),C=await z;if(!C.ok)throw new Error("Facilities HTTP "+C.status);x=(await C.json()).facilities||[];var T=await S;if(!T.ok)throw new Error("Designations HTTP "+T.status);var L=await T.json();if(L.types&&L.types.length>0)for(var q=0;q<L.types.length;q++)k.push(L.types[q].type)}catch(e){return void(p.innerHTML='<p style="padding:1rem;color:red;">Failed to load centers. Please try again later.</p>')}if(h){var M=m.closest(".map_filters-right");M&&M.remove()}else{m.innerHTML="";for(q=0;q<k.length;q++){var _=k[q],N=l(_),U=document.createElement("div");U.className="multi-step_checkbox-wrapper";var E=document.createElement("input");E.type="checkbox",E.name="designations",E.id="designation-"+_,E.value=_,E.className="multi-step_checkbox_icon";var P=document.createElement("label");P.htmlFor=E.id,P.className="form_field-label",P.textContent=N,U.appendChild(E),U.appendChild(P),m.appendChild(U),E.addEventListener("change",Z)}}var F=function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];if(r.designations&&0!==r.designations.length){for(var a=[],i=0;i<r.designations.length;i++){var o=r.designations[i].type;o&&-1===a.indexOf(o)&&a.push(o)}for(var s={},l=0;l<r.designations.length;l++){var c,d,p,g,f,m=r.designations[l];if(m.overrides&&m.overrides.address&&null!=m.overrides.address.latitude&&null!=m.overrides.address.longitude){var u=m.overrides.address;c=parseFloat(u.latitude),d=parseFloat(u.longitude),p=[u.line1,u.line2,u.city,u.state,u.zip].filter(Boolean).join(", "),g=m.overrides.phone||r.phone,f=m.overrides.url||r.website}else{c=parseFloat(r.latitude),d=parseFloat(r.longitude);var h=r.address||{};p=[h.line1,h.line2,h.city,h.state,h.zip].filter(Boolean).join(", "),g=r.phone,f=r.website}if(!isNaN(c)&&!isNaN(d)){var v=c+","+d;s[v]||(s[v]={lat:c,lng:d,address:p,phone:g,website:f})}}for(var w=r.address||{},y=Object.keys(s),b=0;b<y.length;b++){var x=s[y[b]];t.push({fid:r.fid,name:r.name,lat:x.lat,lng:x.lng,address:x.address,phone:x.phone,website:x.website,imageUrl:r.image_url,zip:w.zip||"",city:w.city||"",state:w.state||"",designationTypes:a})}}}return t}(x);if(h){var H=[];for(q=0;q<F.length;q++)-1!==F[q].designationTypes.indexOf("screening")&&H.push(F[q]);F=H}var j=[],I=null;function A(e){p.innerHTML="",I&&(I.clearMarkers(),I=null);for(var t=0;t<j.length;t++)j[t].setMap(null);if(j=[],0!==e.length){var a=new google.maps.LatLngBounds;for(t=0;t<e.length;t++){var i=e[t],o=u.cloneNode(!0);o.dataset.id=i.fid;var s=o.querySelector('[data-center="icon"]');s&&(s.src=y.url,s.alt="Map pin");var c=o.querySelector('[data-custom="center-name"]');c&&(c.textContent=i.name);var d=o.querySelector('[data-custom="center-city"]');d&&(d.textContent=i.city);var g=o.querySelector('[data-custom="center-zip-code"]');g&&(g.textContent=i.zip);var f=o.querySelector('[data-centers="where"]');if(f)if(i.website){f.href=i.website;try{var m=new URL(i.website).hostname;0===m.indexOf("www.")&&(m=m.slice(4)),f.textContent=m}catch(e){f.textContent=i.website}}else f.parentElement&&f.parentElement.remove();var h=o.querySelector('[data-custom="center-accreditations"]');if(h){for(var w=[],b=0;b<i.designationTypes.length;b++)w.push(l(i.designationTypes[b]));h.textContent=w.join(", ")}o.addEventListener("click",B(i)),p.appendChild(o);var x={lat:i.lat,lng:i.lng},k=new google.maps.Marker({position:x,icon:y,map:null});k.addListener("click",O(k,i)),j.push(k),a.extend(x)}I=new n({map:v,markers:j,renderer:{render:D},algorithm:new r({radius:60})}),j.length>1?v.fitBounds(a):1===j.length&&(v.setCenter(j[0].getPosition()),v.setZoom(14))}else p.innerHTML='<p style="padding:1rem;color:#666;">No centers match your search.</p>'}function B(e){return function(){v.setCenter({lat:e.lat,lng:e.lng}),v.setZoom(14);for(var t=0;t<j.length;t++){var n=j[t].getPosition();if(n.lat()===e.lat&&n.lng()===e.lng){b.setContent(d(e)),b.open(v,j[t]);break}}}}function O(e,t){return function(){b.setContent(d(t)),b.open(v,e)}}function D(e){var t=e.count,n=e.position,r=function(e){var t=String(e).length,n=36;2===t&&(n=40),t>2&&(n=48);var r=n/2;return{url:"data:image/svg+xml;charset=UTF-8,"+encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="'+n+'" height="'+n+'" viewBox="0 0 '+n+" "+n+'"><circle cx="'+r+'" cy="'+r+'" r="'+(r-2)+'" fill="#ffffff" stroke="#2c3495" stroke-width="3"/><text x="'+r+'" y="'+r+'" text-anchor="middle" dominant-baseline="central" fill="#2c3495" font-family="Arial,Helvetica,sans-serif" font-weight="800" font-size="14">'+e+"</text></svg>"),scaledSize:new google.maps.Size(n,n),anchor:new google.maps.Point(r,r)}}(t);return new google.maps.Marker({position:n,icon:r,zIndex:1e3+t})}function Z(){var e=F,t=f.value.trim();if(""!==t){for(var n=[],r=0;r<e.length;r++)String(e[r].zip).startsWith(t)&&n.push(e[r]);e=n}var a=[];if(!h){var i=m.querySelectorAll('input[name="designations"]:checked');for(r=0;r<i.length;r++)a.push(i[r].value)}if(a.length>0){var o=[];for(r=0;r<e.length;r++){for(var s=e[r],l=!1,c=0;c<a.length;c++)if(-1!==s.designationTypes.indexOf(a[c])){l=!0;break}l&&o.push(s)}e=o}A(e)}A(F),f.addEventListener("input",Z);var G=document.querySelector('[data-centers="list-item"]');G&&G.remove()}export{p as default};
