{"version":3,"file":"helpline-BzQ31vuB.js","sources":["../src/components/forms/helpline.js"],"sourcesContent":["import {\n  serializeInputs,\n  clearStepsErrors,\n  appendStepsErrors,\n  setButtonLoading,\n  resetButton,\n  hideFail,\n  showFail,\n  showSuccess,\n  hideForm,\n} from '../../utils/functions'\n\nimport validator from 'validator'\n\n/**\n * Handles form submission for a multi-step form component.\n * @param {HTMLElement} component - The form component containing steps and inputs.\n */\nexport default function (component) {\n  const formInstances = component.forEach ? component : [component]\n\n  formInstances.forEach((formInstance) => {\n    const webhookAddress = formInstance.dataset.webhook || 'https://hook.us2.make.com/x3fm8t3nor5poc4ij7purslvicjo9sxr'\n    const steps = Array.from(formInstance.querySelectorAll('[data-form=\"step\"]'))\n    const ticketIdField = formInstance.querySelector('[data-helpline-form=\"ticket-id-field\"]')\n\n    const successEl = formInstance.querySelector('.w-form-done')\n    const failEl = formInstance.querySelector('.w-form-fail')\n    const formEl = formInstance.querySelector('form')\n\n    if (ticketIdField) {\n      ticketIdField.disabled = true\n      ticketIdField.type = 'hidden'\n    }\n\n    // hide all steps except the first one\n    steps.forEach((step, i) => {\n      if (i !== 0) step.classList.add('hide')\n    })\n\n    formInstance.addEventListener('click', (e) => {\n      const target = e.target\n      const nextBtn = target.closest('[data-form=\"next-btn\"]')\n      const submitBtn = target.closest('[data-form=\"submit-btn\"]')\n      const buttonText = target.closest('.button_text')\n\n      // NEXT BUTTON HANDLER\n      if (nextBtn || (buttonText && nextBtn)) {\n        // Hide fail element on button press (validations will rerun)\n        hideFail(failEl)\n\n        const currentStepEl = nextBtn.closest('[data-form=\"step\"]')\n        if (!currentStepEl) return // Avoid errors if no step found\n\n        const currentStepIndex = Array.from(formEl?.children || []).indexOf(currentStepEl)\n        if (currentStepIndex === -1) return // Invalid index, abort\n\n        // Log for debugging\n        console.log('Next button pressed - Step index:', currentStepIndex)\n\n        const stepInputsData = serializeInputs(currentStepEl)\n\n        // Log serialized data for debugging\n        console.log('Next button - Serialized step data:', stepInputsData)\n\n        const errors = []\n\n        // Step-specific validations\n        switch (currentStepIndex) {\n          case 0:\n            // First step validations\n            if (validator.isEmpty(stepInputsData['HelpLine-Name'] || '')) {\n              errors.push({\n                fieldName: 'HelpLine-Name',\n                error: 'Enter your full name',\n                appendAt: '.multi-form14_field-wrapper',\n              })\n            }\n            if (!validator.isEmail(stepInputsData['HelpLine-Email'] || '')) {\n              errors.push({\n                fieldName: 'HelpLine-Email',\n                error: 'Enter a valid email address (example: name@email.com)',\n                appendAt: '.multi-form14_field-wrapper',\n              })\n            }\n            const phone = stepInputsData['HelpLine-Phone'] || ''\n            if (!validator.isMobilePhone(phone, 'any')) {\n              errors.push({\n                fieldName: 'HelpLine-Phone',\n                error: 'Enter a valid phone number (include area code)',\n                appendAt: '.multi-form14_field-wrapper',\n              })\n            }\n            break\n\n          // Add more cases as needed for other steps\n\n          default:\n            break\n        }\n\n        // Clear any existing errors\n        clearStepsErrors(currentStepEl)\n\n        // If there are errors, append them and stop\n        if (errors.length > 0) {\n          appendStepsErrors(errors, currentStepEl)\n          return\n        }\n\n        // Set loading state\n        const nextBtnTextEl = nextBtn.querySelector('.button_text') || nextBtn.firstChild\n        const nextBtnInitialText = nextBtnTextEl?.textContent || 'Next'\n        setButtonLoading(nextBtn)\n\n        fetch(webhookAddress, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(stepInputsData),\n        })\n          .then((response) => {\n            if (!response.ok) {\n              throw new Error(`HTTP error! status: ${response.status}`)\n            }\n            return response.json()\n          })\n          .then((data) => {\n            if (ticketIdField) {\n              ticketIdField.value = data?.ticket || data || ''\n            }\n\n            // Hide current step and show next if exists\n            currentStepEl.classList.add('hide')\n            const nextIndex = currentStepIndex + 1\n            if (nextIndex < steps.length) {\n              steps[nextIndex].classList.remove('hide')\n            } else {\n              console.log('no more steps')\n            }\n          })\n          .catch((error) => {\n            console.error('Fetch error:', error)\n            showFail(failEl)\n          })\n          .finally(() => {\n            resetButton(nextBtn, nextBtnInitialText)\n          })\n      }\n\n      // SUBMIT BUTTON HANDLER\n      if (submitBtn || (buttonText && submitBtn)) {\n        e.preventDefault()\n        e.stopImmediatePropagation()\n\n        // Hide fail element on button press (validations will rerun)\n        hideFail(failEl)\n\n        const currentStepEl = submitBtn.closest('[data-form=\"step\"]')\n        if (!currentStepEl) return // Avoid errors if no step found\n\n        const currentStepIndex = Array.from(formEl?.children || []).indexOf(currentStepEl)\n        if (currentStepIndex === -1) return // Invalid index, abort\n\n        // Log for debugging\n        console.log('Submit button pressed - Step index:', currentStepIndex)\n\n        const submitInputsData = serializeInputs(currentStepEl)\n\n        // Log serialized data for debugging\n        console.log('Submit button - Serialized submit data:', submitInputsData)\n\n        const errors = []\n\n        // Submit step validations\n        // if (!validator.isPostalCode(String(submitInputsData?.['Phone-Buddy-Zip-Code'] || ''), 'any')) {\n        //   errors.push('Enter a valid ZIP or postal code.')\n        // }\n\n        // if ('Other-cancer-type' in submitInputsData && validator.isEmpty(submitInputsData['Other-cancer-type'] || '')) {\n        //   errors.push('Tell us what type of cancer you have.')\n        // }\n\n        // if ('Other-treatment' in submitInputsData && validator.isEmpty(submitInputsData['Other-treatment'] || '')) {\n        //   errors.push('Specify the treatment you received.')\n        // }\n\n        // if (\n        //   'Other-way-of-hearing-about-GO2' in submitInputsData &&\n        //   validator.isEmpty(submitInputsData['Other-way-of-hearing-about-GO2'] || '')\n        // ) {\n        //   errors.push('Describe how you heard about GO2.')\n        // }\n\n        // Clear any existing errors\n        clearStepsErrors(currentStepEl)\n\n        // If there are errors, append them and stop\n        if (errors.length > 0) {\n          appendStepsErrors(errors, currentStepEl)\n          return\n        }\n\n        // Set loading state\n        const submitBtnTextEl = submitBtn.querySelector('.button_text') || submitBtn.firstChild\n        const submitBtnInitialText = submitBtnTextEl?.textContent || 'Submit'\n        setButtonLoading(submitBtn)\n\n        submitInputsData['ticket-id'] = ticketIdField.value\n\n        fetch(webhookAddress, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(submitInputsData),\n        })\n          .then((response) => {\n            if (!response.ok) throw new Error('Submission failed')\n            return response.json()\n          })\n          .then((data) => {\n            hideForm(formEl)\n            showSuccess(successEl)\n          })\n          .catch((error) => {\n            console.error('Submit fetch error:', error)\n            showFail(failEl)\n          })\n          .finally(() => {\n            resetButton(submitBtn, submitBtnInitialText)\n          })\n      }\n    })\n  })\n}\n"],"names":["helpline","component","forEach","formInstance","webhookAddress","dataset","webhook","steps","Array","from","querySelectorAll","ticketIdField","querySelector","successEl","failEl","formEl","disabled","type","step","i","classList","add","addEventListener","e","target","nextBtn","closest","submitBtn","buttonText","hideFail","currentStepEl","currentStepIndex","children","indexOf","stepInputsData","serializeInputs","errors","validator","isEmpty","push","fieldName","error","appendAt","isEmail","phone","isMobilePhone","clearStepsErrors","length","appendStepsErrors","nextBtnTextEl","firstChild","nextBtnInitialText","textContent","setButtonLoading","fetch","method","headers","body","JSON","stringify","then","response","ok","Error","status","json","data","value","ticket","nextIndex","remove","catch","showFail","finally","resetButton","preventDefault","stopImmediatePropagation","submitInputsData","submitBtnTextEl","submitBtnInitialText","hideForm","showSuccess"],"mappings":"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"}