{"version":3,"file":"phone-buddy-CwPKcxam.js","sources":["../src/components/forms/phone-buddy.js"],"sourcesContent":["import {\n  serializeInputs,\n  setupOtherFieldForSelect,\n  setupOtherFieldForCheckbox,\n  clearStepsErrors,\n  appendStepsErrors,\n  setButtonLoading,\n  resetButton,\n  hideFail,\n  showFail,\n  showSuccess,\n  hideForm,\n} from '../../utils/functions'\n\nimport validator from 'validator'\n\n/**\n * Handles form submission for a multi-step form component.\n * @param {HTMLElement} component - The form component containing steps and inputs.\n */\nexport default function (component) {\n  const webhookAddress = component.dataset.webhook || 'https://hook.us2.make.com/kkvr63k2dtf7sgpx5n2alylvmgf2qvd5'\n  const steps = Array.from(component.querySelectorAll('[data-form=\"step\"]'))\n  const ticketIdField = component.querySelector('[data-phone-buddy-form=\"ticket-id-field\"]')\n\n  const successEl = component.querySelector('.w-form-done')\n  const failEl = component.querySelector('.w-form-fail')\n  const formEl = component.querySelector('form')\n\n  if (ticketIdField) {\n    ticketIdField.disabled = true\n    ticketIdField.type = 'hidden'\n  }\n\n  setupOtherFieldForSelect({\n    selectId: 'Cancer-type',\n    otherValue: 557,\n    fieldName: 'Other-cancer-type',\n    labelName: 'Specify other type of lung cancer',\n    placeholder: 'Specify here',\n  })\n\n  setupOtherFieldForSelect({\n    selectId: 'How-did-you-heard-about-us',\n    otherValue: 98,\n    fieldName: 'Other-way-of-hearing-about-GO2',\n    labelName: 'Describe other way of hearing about GO2',\n    placeholder: 'Specify here',\n  })\n\n  setupOtherFieldForCheckbox({\n    checkboxGroup: 'Phone-Buddy-Treatment',\n    otherValue: 8,\n    fieldName: 'Other-treatment',\n    labelName: 'Specify treatment',\n    placeholder: 'Specify here',\n  })\n\n  // hide all steps except the first one\n  steps.forEach((step, i) => {\n    if (i !== 0) step.classList.add('hide')\n  })\n\n  component.addEventListener('click', (e) => {\n    const target = e.target\n    const nextBtn = target.closest('[data-form=\"next-btn\"]')\n    const submitBtn = target.closest('[data-form=\"submit-btn\"]')\n    const buttonText = target.closest('.button_text')\n\n    // NEXT BUTTON HANDLER\n    if (nextBtn || (buttonText && nextBtn)) {\n      // Hide fail element on button press (validations will rerun)\n      hideFail(failEl)\n\n      const currentStepEl = nextBtn.closest('[data-form=\"step\"]')\n      if (!currentStepEl) return // Avoid errors if no step found\n\n      const currentStepIndex = Array.from(formEl?.children || []).indexOf(currentStepEl)\n      if (currentStepIndex === -1) return // Invalid index, abort\n\n      // Log for debugging\n      console.log('Next button pressed - Step index:', currentStepIndex)\n\n      const stepInputsData = serializeInputs(currentStepEl)\n\n      // Log serialized data for debugging\n      console.log('Next button - Serialized step data:', stepInputsData)\n\n      const errors = []\n\n      // Step-specific validations\n      switch (currentStepIndex) {\n        case 0:\n          // First step validations\n          if (validator.isEmpty(stepInputsData['Phone-Buddy-First-Name'] || '')) {\n            errors.push('Enter your first name.')\n          }\n          if (validator.isEmpty(stepInputsData['Phone-Buddy-Last-Name'] || '')) {\n            errors.push('Enter your last name.')\n          }\n          if (!validator.isEmail(stepInputsData['Phone-Buddy-Email'] || '')) {\n            errors.push('Enter a valid email address (example: name@email.com)')\n          }\n          if (!validator.isMobilePhone(stepInputsData['Phone-Buddy-Phone'] || '')) {\n            errors.push('Enter a valid phone number (digits only, include area code)')\n          }\n          break\n\n        // Add more cases as needed for other steps\n\n        default:\n          break\n      }\n\n      // Clear any existing errors\n      clearStepsErrors(currentStepEl)\n\n      // If there are errors, append them and stop\n      if (errors.length > 0) {\n        appendStepsErrors(currentStepEl, errors)\n        return\n      }\n\n      // Set loading state\n      const nextBtnTextEl = nextBtn.querySelector('.button_text') || nextBtn.firstChild\n      const nextBtnInitialText = nextBtnTextEl?.textContent || 'Next'\n      setButtonLoading(nextBtn)\n\n      fetch(webhookAddress, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(stepInputsData),\n      })\n        .then((response) => {\n          if (!response.ok) {\n            throw new Error(`HTTP error! status: ${response.status}`)\n          }\n          return response.json()\n        })\n        .then((data) => {\n          if (ticketIdField) {\n            ticketIdField.value = data?.ticket || data || ''\n          }\n\n          // Hide current step and show next if exists\n          currentStepEl.classList.add('hide')\n          const nextIndex = currentStepIndex + 1\n          if (nextIndex < steps.length) {\n            steps[nextIndex].classList.remove('hide')\n          } else {\n            console.log('no more steps')\n          }\n        })\n        .catch((error) => {\n          console.error('Fetch error:', error)\n          showFail(failEl)\n        })\n        .finally(() => {\n          resetButton(nextBtn, nextBtnInitialText)\n        })\n    }\n\n    // SUBMIT BUTTON HANDLER\n    if (submitBtn || (buttonText && submitBtn)) {\n      e.preventDefault()\n      e.stopImmediatePropagation()\n\n      // Hide fail element on button press (validations will rerun)\n      hideFail(failEl)\n\n      const currentStepEl = submitBtn.closest('[data-form=\"step\"]')\n      if (!currentStepEl) return // Avoid errors if no step found\n\n      const currentStepIndex = Array.from(formEl?.children || []).indexOf(currentStepEl)\n      if (currentStepIndex === -1) return // Invalid index, abort\n\n      // Log for debugging\n      console.log('Submit button pressed - Step index:', currentStepIndex)\n\n      const submitInputsData = serializeInputs(currentStepEl)\n\n      // Log serialized data for debugging\n      console.log('Submit button - Serialized submit data:', submitInputsData)\n\n      const errors = []\n\n      // Submit step validations\n      if (!validator.isPostalCode(String(submitInputsData?.['Phone-Buddy-Zip-Code'] || ''), 'any')) {\n        errors.push('Enter a valid ZIP or postal code.')\n      }\n\n      if ('Other-cancer-type' in submitInputsData && validator.isEmpty(submitInputsData['Other-cancer-type'] || '')) {\n        errors.push('Tell us what type of cancer you have.')\n      }\n\n      if ('Other-treatment' in submitInputsData && validator.isEmpty(submitInputsData['Other-treatment'] || '')) {\n        errors.push('Specify the treatment you received.')\n      }\n\n      if (\n        'Other-way-of-hearing-about-GO2' in submitInputsData &&\n        validator.isEmpty(submitInputsData['Other-way-of-hearing-about-GO2'] || '')\n      ) {\n        errors.push('Describe how you heard about GO2.')\n      }\n\n      // Clear any existing errors\n      clearStepsErrors(currentStepEl)\n\n      // If there are errors, append them and stop\n      if (errors.length > 0) {\n        appendStepsErrors(currentStepEl, errors)\n        return\n      }\n\n      // Set loading state\n      const submitBtnTextEl = submitBtn.querySelector('.button_text') || submitBtn.firstChild\n      const submitBtnInitialText = submitBtnTextEl?.textContent || 'Submit'\n      setButtonLoading(submitBtn)\n\n      submitInputsData['ticket-id'] = ticketIdField.value\n\n      // Modify message to contain information about: Phone-Buddy-Treatment, Other-treatment, How-did-you-heard-about-us, and Other-way-of-hearing-about-GO2\n      let message = submitInputsData['Phone-Buddy-Message'] || ''\n      const fieldsToAppend = [\n        { key: 'Phone-Buddy-Treatment', label: 'Treatment' },\n        { key: 'Other-treatment', label: 'Other treatment' },\n        {\n          key: 'How-did-you-heard-about-us',\n          label: 'How did you hear about GO2?',\n        },\n        {\n          key: 'Other-way-of-hearing-about-GO2',\n          label: 'Other way of hearing about GO2',\n        },\n      ]\n      // REMAKE THIS SENDING HTML INSTEAD OF TEXT: Format appended fields as HTML for better rendering in the webhook receiver\n      let appended = ''\n      fieldsToAppend.forEach((field) => {\n        if (submitInputsData.hasOwnProperty(field.key)) {\n          const value = submitInputsData[field.key]\n          let formattedValue = ''\n          if (Array.isArray(value) && value.length > 0) {\n            formattedValue = value.join(', ')\n          } else if (typeof value === 'string' && value.trim() !== '') {\n            formattedValue = value\n          } else if (value != null && value.toString().trim() !== '') {\n            formattedValue = value.toString()\n          }\n          if (formattedValue) {\n            appended += `<br><strong>${field.label}:</strong> ${formattedValue}`\n          }\n        }\n      })\n      // Update the message if there's anything to append\n      if (appended) {\n        message = message.trim() ? `${message.trim()}.<br>${appended.trim()}` : appended.trim()\n      }\n      submitInputsData['Phone-Buddy-Message'] = message\n\n      // Log final submit data for debugging\n      console.log('Final submit data (with modified message):', submitInputsData)\n\n      fetch(webhookAddress, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(submitInputsData),\n      })\n        .then((response) => {\n          if (!response.ok) throw new Error('Submission failed')\n          return response.json()\n        })\n        .then((data) => {\n          hideForm(formEl)\n          showSuccess(successEl)\n        })\n        .catch((error) => {\n          console.error('Submit fetch error:', error)\n          showFail(failEl)\n        })\n        .finally(() => {\n          resetButton(submitBtn, submitBtnInitialText)\n        })\n    }\n  })\n}\n"],"names":["phoneBuddy","component","webhookAddress","dataset","webhook","steps","Array","from","querySelectorAll","ticketIdField","querySelector","successEl","failEl","formEl","disabled","type","setupOtherFieldForSelect","selectId","otherValue","fieldName","labelName","placeholder","setupOtherFieldForCheckbox","checkboxGroup","forEach","step","i","classList","add","addEventListener","e","target","nextBtn","closest","submitBtn","buttonText","hideFail","currentStepEl","currentStepIndex","children","indexOf","stepInputsData","serializeInputs","errors","validator","isEmpty","push","isEmail","isMobilePhone","clearStepsErrors","length","appendStepsErrors","nextBtnTextEl","firstChild","nextBtnInitialText","textContent","setButtonLoading","fetch","method","headers","body","JSON","stringify","then","response","ok","Error","status","json","data","value","ticket","nextIndex","remove","catch","error","showFail","finally","resetButton","preventDefault","stopImmediatePropagation","submitInputsData","isPostalCode","String","submitBtnTextEl","submitBtnInitialText","message","appended","key","label","field","hasOwnProperty","formattedValue","isArray","join","trim","toString","hideForm","showSuccess"],"mappings":"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"}